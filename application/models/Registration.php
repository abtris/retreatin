<?php

/**
 * Registration
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class Registration extends BaseRegistration
{
    /**
     * Save Registration
     * @param <type> $array
     */
    public static function saveRegistration($array, $lang = null)
    {
        $r  = new Registration();
        
        foreach ($array as $key => $value) {
            $field = (string) $key;
            $r->$field = $value;            
        }
         
        ZFCore_Utils::log('Add registration: '.var_export($array, true));
        $r->save();

        if (is_null($lang)) {
            $subject = "Retreat with Chögyal Namkhai Norbu";
            $body = "You are registered for the retreat in Merigar East. Thank you for the collaboration. See you in the Gar! \n";
        } elseif ($lang == 'ro') {
            $subject = "Retragerea de Invataturi Dzogchen cu Chögyal Namkhai Norbu";
            $body = "Cererea Dvs. de participare la retragerea din Merigar Est a fost inregistrata.\n  Va multumim pentru colaborare.
                     Va asteptam cu drag la Gar.\n";
        } elseif ($lang == 'ru') {
            $subject = "Ретрит с Чгъялом Намкай Норбу";
            $body = "Вы зарешгистрированны на ретрит в Восточном Меригаре.
    Спасибо за сотрудничество.
    До встречи в Гаре\n";
        }
        // to user
        $options['from'] = "webmaster@dzogchen.cz";
        $options['to'] = $array['email'];
        $options['subject'] = $subject;
        $options['body'] = $body;
        ZFCore_Utils::sendEmail($options);
        // to admin
        $options['from'] = "webmaster@dzogchen.cz";
        $options['to'] = 'martin.kourim@gmail.com';
        $options['subject'] = "[RETREAT] new registration";
        $options['body'] = 'Add registration: '.var_export($array, true);
        ZFCore_Utils::sendEmail($options);
    }

}
